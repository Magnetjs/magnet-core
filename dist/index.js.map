{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;uEAGe;;2EAKb,iBAA4B,GAA5B;YACM,SAMA,wFACK,QACH;;;;;;AARF,0BAAU,IAAI,KAAJ;;;AAEd,oBAAI,CAAC,MAAM,OAAN,CAAc,OAAd,CAAD,EAAyB;AAC3B,4BAAU,CAAC,OAAD,CAAV,CAD2B;iBAA7B;;AAII,yBAAS;;;;;uDACM;;;;;;;;AAAV;AACH;;AACJ,oBAAI,OAAO,MAAP,EAAe;AACjB,0BAAQ,GAAR,CAAY,OAAO,MAAP,CAAZ,CADiB;AAEjB,yBAAO,IAAI,OAAO,MAAP,CAAc,GAAlB,EAAuB,OAAO,OAAP,CAA9B,CAFiB;iBAAnB,MAGO;AACL,yBAAO,IAAI,MAAJ,CAAW,GAAX,CAAP,CADK;iBAHP;;qBAOI,KAAK,KAAL;;;;;8BACF;;uBAAkB,KAAK,KAAL;;;;;4BAAX;;;;AAGT,oBAAI,KAAK,KAAL,EAAY;AACd,yBAAO,IAAP,CAAY,KAAK,KAAL,CAAW,IAAX,CAAgB,IAAhB,CAAZ,EADc;iBAAhB;;AAIA,oBAAI,KAAK,QAAL,EAAe;AACjB,4BAAU,IAAV,CAAe,KAAK,QAAL,CAAc,IAAd,CAAmB,IAAnB,CAAf,EADiB;iBAAnB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;uBAKI;;;qBAEF,IAAI,MAAJ;;;;;;uBACI,aAAa,GAAb;;;;;;;;OAjCV;sBAAe;;;;;QALoB,gEAAU;;QACzC,KACA,QACA,gGA2CS;;;;;;AA7CT,kBAAM;AACN,qBAAS;AACT,wBAAY;;;iBAwCV,QAAQ,MAAR;;;;;;mBACI,aAAa,OAAb;;;;;;;oDAEY,OAAO,OAAP;;;;;;;;AAAT;;mBACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGR,oBAAQ,GAAR,CAAY,OAAZ;;;;;AAEA,oBAAQ,GAAR,CAAY,sBAAZ;;;8CAGK;;;;;;AAEP,oBAAQ,KAAR,CAAc,aAAI,KAAJ,CAAd;;;;;;;;GAzDW;;WAAe","file":"index.js","sourcesContent":["/**\n * We can change setup to be middleware based, but now let keep it simple with array only.\n */\nexport default async function Magnet(modules = []) {\n  let app = {};\n  let starts = [];\n  let teardowns = [];\n\n  async function performTasks(arr) {\n    let Modules = arr.shift();\n\n    if (!Array.isArray(Modules)) {\n      Modules = [Modules];\n    }\n\n    let setups = [];\n    for (let Module of Modules) {\n      let task;\n      if (Module.module) {\n        console.log(Module.module);\n        task = new Module.module(app, Module.options);\n      } else {\n        task = new Module(app);\n      }\n\n      if (task.setup) {\n        setups.push(await task.setup());\n      }\n\n      if (task.start) {\n        starts.push(task.start.bind(task));\n      }\n\n      if (task.teardown) {\n        teardowns.push(task.teardown.bind(task));\n      }\n    }\n\n    await setups;\n\n    if (arr.length) {\n      await performTasks(arr);\n    }\n  }\n\n  try {\n    if (modules.length) {\n      await performTasks(modules);\n\n      for (let start of starts.reverse()) {\n        await start();\n      }\n\n      console.log('Ready');\n    } else {\n      console.log('No modules provided.');\n    }\n\n    return app;\n  } catch (err) {\n    console.error(err.stack);\n  }\n}\n"],"sourceRoot":"/source/"}